const path=require("path"),express=require("express"),helmet=require("helmet"),bodyParser=require("body-parser"),cors=require("cors"),morgan=require("morgan"),fileStreamRotator=require("file-stream-rotator"),fs=require("fs"),logger=require(path.join(__dirname,"core","Logger.js")),env=require(path.join(__dirname,"config","env.json")),app=express();if(app.use(helmet()),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(cors()),app.use(express.static(path.join(__dirname,"webapp"))),"production"===process.env.NODE_ENV){const e=path.join(__dirname,"logs");fs.existsSync(e)||fs.mkdirSync(e);const s=fileStreamRotator.getStream({date_format:"YYYY-MM-DD",filename:path.join(e,"access-%DATE%.log"),frequency:"daily",verbose:!1});app.use(morgan("combined",{stream:s}))}else app.use(morgan("combined"));app.get("/",(e,s)=>{s.status(200).send("May the force be with you.")}),app.get("/infos",(e,s)=>{s.status(200).send({success:!0})});const messageRouter=require(path.join(__dirname,"bundles","message","messageRouter.js")),smsRouter=require(path.join(__dirname,"bundles","sms","smsRouter.js"));app.use("/message",messageRouter),app.use("/sms",smsRouter);const srv=app.listen(env[process.env.NODE_ENV].port,env[process.env.NODE_ENV].host,()=>{logger.info("Server run on port",env[process.env.NODE_ENV].port,"in",process.env.NODE_ENV,"environment")});module.exports=srv;